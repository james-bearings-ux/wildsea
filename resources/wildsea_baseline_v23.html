<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wildsea Character Sheet</title>
  <link href="https://fonts.googleapis.com/css2?family=Faustina:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background: #FFFFFF;
      color: #111827;
    }
    
    .font-faustina {
      font-family: 'Faustina', serif;
    }
    
    button, select, input {
      font-family: inherit;
      font-size: inherit;
    }
    
    button {
      border: 2px solid #6B7280;
      background: white;
      padding: 8px 12px;
      border-radius: 2px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
      font-weight: 600;
    }
    
    button:hover:not(:disabled) {
      background: #F3F4F6;
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    button.bg-black {
      background: #000000;
      color: white;
      border-color: #000000;
    }
    
    button.bg-black:hover:not(:disabled) {
      background: #1F2937;
    }
    
    button.primary {
      background: #A91D3A;
      color: white;
      border-color: #A91D3A;
    }
    
    button.primary:hover:not(:disabled) {
      background: #8B1730;
    }
    
    select {
      border: 2px solid #6B7280;
      background: white;
      padding: 8px;
      border-radius: 2px;
      cursor: pointer;
    }
    
    input {
      border: none;
      border-bottom: 2px solid #000000;
      background: white;
      padding: 8px 10px;
      outline: none;
    }
    
    input:disabled {
      border-bottom-color: #E5E7EB;
      color: #D1D5DB;
    }
    
    input::placeholder {
      color: #9CA3AF;
    }
    
    .aspect-card {
      border: 2px solid #6B7280;
      border-radius: 2px;
      padding: 12px 16px;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .aspect-card.selected {
      background: #000000;
      border-color: #0F172A;
      color: white;
    }
    
    .aspect-card.selected .aspect-type {
      color: #9CA3AF;
    }
    
    .aspect-card.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .track-box {
      width: 26px;
      height: 26px;
      border: 2px solid #6B7280;
      border-radius: 4px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .track-box.small {
      width: 16px;
      height: 16px;
    }
    
    .track-box.marked {
      background: #DC2626;
      border-color: #B91C1C;
      color: white;
    }
    
    .track-box.active {
      background: #000000;
      border-color: #000000;
      color: white;
    }
    
    .track-box.burned {
      background: #92400E;
      border-color: #78350F;
      color: white;
    }
    
    .track-box.new {
      background: #84CC16;
      border-color: #4D7C0F;
    }
    
    .edge-card {
      border: 2px solid #6B7280;
      border-radius: 2px;
      padding: 12px 16px;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .edge-card.selected {
      background: #000000;
      border-color: #0F172A;
      color: white;
    }
    
    .edge-card.selected .edge-tagline {
      color: #9CA3AF;
    }
    
    .edge-card.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .sticky-action-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid #9CA3AF;
      padding: 10px;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      z-index: 1000;
    }
    
    .budget-indicator {
      background: #000000;
      color: white;
      padding: 4px 8px;
      border-radius: 2px;
      font-size: 18px;
      font-weight: 600;
    }

    .loading {
      text-align: center;
      padding: 40px;
      font-size: 18px;
      color: #6B7280;
    }
    
    input[type="checkbox"] {
      width: 18px;
      height: 18px;
      border: 2px solid #6B7280;
      border-radius: 2px;
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    input[type="checkbox"]:checked {
      background: #000000;
      border-color: #000000;
    }
    
    input[type="checkbox"]:checked::after {
      content: 'âœ“';
      color: white;
      font-size: 14px;
      font-weight: bold;
    }
    
    input[type="checkbox"]:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    /* Typography utilities */
    .section-header {
      font-family: 'Faustina', serif;
      font-size: 22px;
      font-weight: 600;
      color: #9CA3AF;
      margin: 0 0 12px 0;
    }
    
    .subsection-header {
      font-family: 'Faustina', serif;
      font-size: 16px;
      font-weight: 600;
      color: #9CA3AF;
      margin: 0;
    }
    
    .char-name-header {
      font-family: 'Faustina', serif;
      font-size: 24px;
      font-weight: 700;
    }
    
    .char-label {
      font-family: 'Faustina', serif;
      font-size: 12px;
      color: #6B7280;
      margin-bottom: 4px;
    }
    
    /* Layout utilities */
    .grid-3col {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      align-items: start;
    }
    
    .grid-milestone {
      display: grid;
      grid-template-columns: 60px 1fr 110px;
      gap: 8px;
      align-items: center;
    }
    
    .flex-between {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .flex-col-gap {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    /* Input utilities */
    .text-input {
      border: none;
      border-bottom: 2px solid #000000;
      background: white;
      padding: 8px 10px;
      outline: none;
      width: 100%;
      font-size: 14px;
    }
    
    .text-input:disabled {
      border-bottom-color: #E5E7EB;
      color: #D1D5DB;
    }
    
    .text-input::placeholder {
      color: #9CA3AF;
    }
    
    .select-input {
      border: 2px solid #6B7280;
      background: white;
      padding: 8px;
      border-radius: 2px;
      cursor: pointer;
      font-size: 14px;
    }
    
    /* Content utilities */
    .aspect-name {
      font-weight: 600;
      font-size: 16px;
    }
    
    .aspect-meta {
      font-size: 12px;
      color: #6B7280;
      margin-bottom: 4px;
    }
    
    .aspect-description {
      font-size: 12px;
      color: #6B7280;
    }
    
    .skill-name {
      font-weight: 600;
    }
    
    .skill-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 0;
      border-bottom: 1px solid #E5E7EB;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="loading">Loading aspect data...</div>
  </div>
  
  <script>    
    // Core game data
    const GAME_DATA = {
      bloodlines: ['Ardent', 'Ektus', 'Gau', 'Ironbound', 'Ketra', 'Mothryn', 'Tzelicrae'],
      origins: ['Amberclad', 'Anchored', 'Ridgeback', 'Rootless', 'Shankling', 'Spit-Born'],
      posts: ['Alchemist', 'Char', 'Corsair', 'Crash', 'Dredger', 'Hacker', 'Horizoneer', 'Hunter', 'Mesmer', 'Navigator', 'Rattlehand', 'Screw', 'Slinger', 'Steep', 'Surgeon', 'Tempest', 'Wordbearer'],
      edges: [
        { name: 'Grace', tagline: 'An edge of elegance, precision, & agility' },
        { name: 'Iron', tagline: 'An edge of strength, endurance, & fortitude' },
        { name: 'Instinct', tagline: 'An edge of awareness, intuition, & reaction' },
        { name: 'Teeth', tagline: 'An edge of combat, violence, & aggression' },
        { name: 'Sharps', tagline: 'An edge of cunning, knowledge, & expertise' },
        { name: 'Tides', tagline: 'An edge of luck, fortune, & supernatural' },
        { name: 'Veils', tagline: 'An edge of stealth, deception, & subterfuge' }
      ],
      skills: [
        'Break', 'Concoct', 'Cook', 'Delve', 'Flourish', 'Hack',
        'Harvest', 'Hunt', 'Outwit', 'Rattle', 'Scavenge', 'Sense',
        'Study', 'Sway', 'Tend', 'Vault', 'Wavewalk'
      ],
      languages: [
        'Low Sour', 'Raka Spit', 'Chthonic', 'Lyre-Bite',
        'Saprekk', 'Old Hand', 'Gaudimm', 'Signaling', 'Knock'
      ],
      aspects: {}
    };
    
    // Initialize character state
    let character = {
      mode: 'creation',
      name: '',
      bloodline: 'Tzelicrae',
      origin: 'Ridgeback',
      post: 'Mesmer',
      selectedAspects: [],
      selectedEdges: [],
      skills: {},
      languages: { 'Low Sour': 3 },
      milestones: [],
      drives: ['', '', ''],
      mires: [
        { text: '', checkbox1: false, checkbox2: false },
        { text: '', checkbox1: false, checkbox2: false },
        { text: '', checkbox1: false, checkbox2: false }
      ]
    };
    
    // Budget tracking
    const BUDGETS = {
      aspects: 4,
      edges: 3,
      skillPoints: 8
    };

    // Load aspect data inline
    async function loadAspectData() {
      const bloodlineText = `Bloodline	Ardent	Tough as Nails [Trait]	4	You're a natural survivor. Rolls made to treat or heal an injury you're suffering from treat conflicts as triumphs.
Bloodline	Ardent	Ghostsight [Trait]	3	You can clearly see spirits and the spectral realm.
Bloodline	Ardent	Strong Stomach [Trait]	3	Reduce the impact of poisons, diseases and sickness.
Bloodline	Tzelicrae	Iron Satchel [Gear]	4	A secure, wearable lockbox that can only be opened by a single specific spider within you.
Bloodline	Tzelicrae	Blade of Husks [Gear]	3	A ritual weapon made from the chitin of lost colony members. Deals CQ keen or salt damage.
Bloodline	Tzelicrae	Swarm-Scout [Companion]	3	A single spider you can send ahead as a scout, allowing you to see and hear at a distance.
Bloodline	Tzelicrae	Rogue Doomsayer [Companion]	3	An unsettled fragment of personality. Mark to request a dark and unbidden (but likely pertinent) thought from the Firefly.
Bloodline	Tzelicrae	Bidingweb [Trait]	2	Slim filaments surround you, almost impossible to see. Mark to entangle a target.`;

      const originText = `Origin	Ridgeback	Cargo Hauler [Gear]	2	A sturdy pack or set of bags that can hold twice what a normal pack could.
Origin	Ridgeback	Wilderness Survival [Trait]	2	You can easily forage food from the environment. Treat conflicts as triumphs when searching for supplies.`;

      const postText = `Post	Mesmer	Intricate Tattoos [Trait]	3	You're immune to confusion and hallucinations that you don't invite or create yourself.
Post	Mesmer	Staredown [Trait]	5	Locking eyes with an opponent allows you to assail their mind with unwanted sensation, manifesting as LR Salt damage. Only works on creatures with sight.
Post	Mesmer	Chameleon Veil [Gear]	3	Use a task to hold still and blend in with your surroundings, becoming almost impossible to notice until you move again.
Post	Mesmer	Shard of Dream-Soaked Amber [Gear]	3	Consume a specimen to experience a thought or memory from a nearby individual.
Post	Mesmer	Seven-Eye Scrawl [Gear]	2	Eyes are daubed across your body, each of them able to perceive the world in a different way. Mark to gain a specialized form of sight for a brief time (such as the ability to see ghosts, heat, or magnetism).
Post	Mesmer	Smoked-Glass Hookah [Gear]	3	Releases a steady stream of wispy smoke. Mark to control smoke or vapours.
Post	Mesmer	Chromiguana [Companion]	4	Slow-moving and sleepy, usually found curled up around your shoulders or at the bottom of a bag. A surprisingly relaxing presence - treat conflicts as triumphs when trying to calm yourself or others.
Post	Mesmer	Pinned Butterfly [Companion]	3	Mark to wake the butterfly for a brief time. While awake, the hypnotic patterns of the butterfly's wings induce drowsiness in those that catch sight of them.`;

      function parseAspectData(text) {
        const lines = text.split('\n').filter(line => line.trim());
        const aspectsBySource = {};
        
        for (const line of lines) {
          const parts = line.split('\t');
          if (parts.length < 5) continue;
          
          const source = parts[1];
          const nameWithType = parts[2];
          const track = parseInt(parts[3]);
          const description = parts[4];
          
          const typeMatch = nameWithType.match(/\[(.+?)\]/);
          const type = typeMatch ? typeMatch[1] : 'Trait';
          const name = nameWithType.replace(/\s*\[.+?\]\s*/, '').trim();
          
          if (!aspectsBySource[source]) {
            aspectsBySource[source] = [];
          }
          
          aspectsBySource[source].push({ name, type, track, description });
        }
        
        return aspectsBySource;
      }

      const bloodlineAspects = parseAspectData(bloodlineText);
      const originAspects = parseAspectData(originText);
      const postAspects = parseAspectData(postText);

      GAME_DATA.aspects = {
        ...bloodlineAspects,
        ...originAspects,
        ...postAspects
      };
      
      render();
    }
    
    function getAvailableAspects() {
      const available = [];
      
      const bloodlineAspects = GAME_DATA.aspects[character.bloodline] || [];
      bloodlineAspects.forEach(aspect => {
        available.push({
          ...aspect,
          source: character.bloodline,
          category: 'Bloodline'
        });
      });
      
      const originAspects = GAME_DATA.aspects[character.origin] || [];
      originAspects.forEach(aspect => {
        available.push({
          ...aspect,
          source: character.origin,
          category: 'Origin'
        });
      });
      
      const postAspects = GAME_DATA.aspects[character.post] || [];
      postAspects.forEach(aspect => {
        available.push({
          ...aspect,
          source: character.post,
          category: 'Post'
        });
      });
      
      return available;
    }
    
    function toggleAspect(aspectId) {
      if (character.mode !== 'creation' && character.mode !== 'advancement') return;
      
      const index = character.selectedAspects.findIndex(a => a.id === aspectId);
      
      if (index >= 0) {
        character.selectedAspects.splice(index, 1);
      } else {
        if (character.mode === 'creation' && character.selectedAspects.length >= BUDGETS.aspects) {
          return;
        }
        
        const allAspects = getAvailableAspects();
        const aspect = allAspects.find(a => {
          const id = `${a.source}-${a.name}`;
          return id === aspectId;
        });
        
        if (aspect) {
          character.selectedAspects.push({
            id: aspectId,
            ...aspect,
            trackSize: aspect.track,
            damageStates: Array(aspect.track).fill('default')
          });
        }
      }
      
      render();
    }
    
    function toggleEdge(edgeName) {
      if (character.mode !== 'creation') return;
      
      const index = character.selectedEdges.indexOf(edgeName);
      
      if (index >= 0) {
        character.selectedEdges.splice(index, 1);
      } else {
        if (character.selectedEdges.length >= BUDGETS.edges) {
          return;
        }
        character.selectedEdges.push(edgeName);
      }
      
      render();
    }
    
    function adjustSkill(name, delta) {
      const current = character.skills[name] || 0;
      const newValue = Math.max(0, Math.min(character.mode === 'creation' ? 2 : 3, current + delta));
      
      if (character.mode === 'creation') {
        const totalPoints = Object.values(character.skills).reduce((sum, v) => sum + v, 0);
        const languagePoints = Object.entries(character.languages)
          .filter(([name]) => name !== 'Low Sour')
          .reduce((sum, [,v]) => sum + v, 0);
        
        if (delta > 0 && totalPoints + languagePoints >= BUDGETS.skillPoints) {
          return;
        }
      }
      
      if (newValue === 0) {
        delete character.skills[name];
      } else {
        character.skills[name] = newValue;
      }
      
      render();
    }
    
    function adjustLanguage(name, delta) {
      if (name === 'Low Sour' && character.mode === 'creation') {
        return;
      }
      
      const current = character.languages[name] || 0;
      const newValue = Math.max(0, Math.min(character.mode === 'creation' ? 2 : 3, current + delta));
      
      if (character.mode === 'creation') {
        const skillPoints = Object.values(character.skills).reduce((sum, v) => sum + v, 0);
        const totalPoints = Object.entries(character.languages)
          .filter(([n]) => n !== 'Low Sour')
          .reduce((sum, [,v]) => sum + v, 0);
        
        if (delta > 0 && skillPoints + totalPoints >= BUDGETS.skillPoints) {
          return;
        }
      }
      
      if (newValue === 0 && name !== 'Low Sour') {
        delete character.languages[name];
      } else {
        character.languages[name] = newValue;
      }
      
      render();
    }
    
    function cycleAspectDamage(aspectId, boxIndex) {
      if (character.mode !== 'play') return;
      
      const aspect = character.selectedAspects.find(a => a.id === aspectId);
      if (!aspect) return;
      
      const states = ['default', 'marked', 'burned'];
      const currentState = aspect.damageStates[boxIndex];
      const currentIndex = states.indexOf(currentState);
      const nextIndex = (currentIndex + 1) % states.length;
      
      aspect.damageStates[boxIndex] = states[nextIndex];
      render();
    }
    
    function expandAspectTrack(aspectId, delta) {
      if (character.mode !== 'advancement') return;
      
      const aspect = character.selectedAspects.find(a => a.id === aspectId);
      if (!aspect) return;
      
      const newSize = aspect.trackSize + delta;
      if (newSize < aspect.track || newSize > 5) return;
      
      if (delta > 0) {
        aspect.damageStates.push('default');
      } else {
        aspect.damageStates.pop();
      }
      
      aspect.trackSize = newSize;
      render();
    }
    
    function addMilestone() {
      character.milestones.push({
        id: Date.now().toString(),
        used: false,
        name: '',
        scale: 'Minor'
      });
      render();
    }
    
    function updateMilestoneName(id, name) {
      const milestone = character.milestones.find(m => m.id === id);
      if (milestone) {
        milestone.name = name;
      }
    }
    
    function updateMilestoneScale(id, scale) {
      const milestone = character.milestones.find(m => m.id === id);
      if (milestone) {
        milestone.scale = scale;
        render();
      }
    }
    
    function toggleMilestoneUsed(id) {
      const milestone = character.milestones.find(m => m.id === id);
      if (milestone) {
        milestone.used = !milestone.used;
        render();
      }
    }
    
    function deleteMilestone(id) {
      const index = character.milestones.findIndex(m => m.id === id);
      if (index >= 0) {
        character.milestones.splice(index, 1);
        render();
      }
    }
    
    function updateDrive(index, value) {
      character.drives[index] = value;
    }
    
    function updateMire(index, value) {
      character.mires[index].text = value;
    }
    
    function toggleMireCheckbox(index, checkboxNum) {
      if (checkboxNum === 1) {
        character.mires[index].checkbox1 = !character.mires[index].checkbox1;
      } else {
        character.mires[index].checkbox2 = !character.mires[index].checkbox2;
      }
      render();
    }
    
    function renderMilestones() {
      return `
        <div style="margin-bottom: 32px;">
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 32px;">            
            ${renderDrivesAndMires()}
			
          <div>
            <h2 class="section-header">Milestones</h2>
            
            ${character.milestones.length > 0 ? `
              <div class="grid-milestone" style="margin-bottom: 8px;">
                <h3 class="subsection-header">Used</h3>
                <h3 class="subsection-header">Name</h3>
                <h3 class="subsection-header">Scale</h3>
              </div>
            ` : ''}
            
            ${character.milestones.map(milestone => `
              <div class="grid-milestone" style="margin-bottom: 8px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                  <div style="width: 34px;"></div>
                  <input type="checkbox" 
                         ${milestone.used ? 'checked' : ''} 
                         onchange="toggleMilestoneUsed('${milestone.id}')">
                </div>
                <input type="text" 
                       value="${milestone.name}" 
                       placeholder="Enter milestone name..." 
                       ${milestone.used ? 'disabled' : ''}
                       onchange="updateMilestoneName('${milestone.id}', this.value)"
                       style="width: 100%;">
                <select ${milestone.used ? 'disabled' : ''} 
                        onchange="updateMilestoneScale('${milestone.id}', this.value)"
                        style="width: 100%;">
                  <option value="Minor" ${milestone.scale === 'Minor' ? 'selected' : ''}>Minor</option>
                  <option value="Major" ${milestone.scale === 'Major' ? 'selected' : ''}>Major</option>
                </select>
              </div>
            `).join('')}
            
            <button onclick="addMilestone()" style="width: 100%; margin-top: ${character.milestones.length > 0 ? '12' : '0'}px;">+ New Milestone</button>
          </div>
          </div>
        </div>
      `;
    }
    
    function renderDrivesAndMires() {
      if (character.mode === 'creation') {
        return `
          <div>
            <h2 class="section-header">Drives</h2>
            <div style="display: flex; flex-direction: column; gap: 2px;">
              ${character.drives.map((drive, i) => `
                <input type="text" 
                       value="${drive}" 
                       placeholder="Enter a drive..." 
                       onchange="updateDrive(${i}, this.value)"
                       style="width: 100%; padding: 8px 10px 8px 10px;">
              `).join('')}
            </div>
          </div>
          
          <div>
            <h2 class="section-header">Mires</h2>
            <div style="display: flex; flex-direction: column; gap: 2px;">
              ${character.mires.map((mire, i) => `
                <input type="text" 
                       value="${mire.text}" 
                       placeholder="Enter a mire..." 
                       onchange="updateMire(${i}, this.value)"
                       style="width: 100%; padding: 8px 10px 8px 10px;">
              `).join('')}
            </div>
          </div>
        `;
      } else if (character.mode === 'play') {
        return `
          <div>
            <h2 class="section-header">Drives</h2>
            <div style="display: flex; flex-direction: column; gap: 2px;">
              ${character.drives.map((drive, i) => `
                <input type="text" 
                       value="${drive}" 
                       placeholder="Enter a drive..." 
                       onchange="updateDrive(${i}, this.value)"
                       style="width: 100%; padding: 8px 10px 8px 10px;">
              `).join('')}
            </div>
          </div>
          
          <div>
            <h2 class="section-header">Mires</h2>
            <div style="display: flex; flex-direction: column; gap: 2px;">
              ${character.mires.map((mire, i) => `
                <div style="display: flex; gap: 10px; align-items: center;">
                  <div style="width: 8px;"></div>
                  <input type="checkbox" 
                         ${mire.checkbox1 ? 'checked' : ''}
                         onchange="toggleMireCheckbox(${i}, 1)">
                  <input type="checkbox" 
                         ${mire.checkbox2 ? 'checked' : ''}
                         onchange="toggleMireCheckbox(${i}, 2)">
                  <input type="text" 
                         value="${mire.text}" 
                         placeholder="Enter a mire..." 
                         onchange="updateMire(${i}, this.value)"
                         style="width: 100%; padding: 8px 10px 8px 10px;">
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }
      return '';
    }
    
    function generateRandomCharacter() {
      character.name = 'Random Character';
      character.bloodline = GAME_DATA.bloodlines[Math.floor(Math.random() * GAME_DATA.bloodlines.length)];
      character.origin = GAME_DATA.origins[Math.floor(Math.random() * GAME_DATA.origins.length)];
      character.post = GAME_DATA.posts[Math.floor(Math.random() * GAME_DATA.posts.length)];
      
      character.selectedAspects = [];
      character.selectedEdges = [];
      character.skills = {};
      character.languages = { 'Low Sour': 3 };
      character.milestones = [];
      character.drives = ['', '', ''];
      character.mires = [
        { text: '', checkbox1: false, checkbox2: false },
        { text: '', checkbox1: false, checkbox2: false },
        { text: '', checkbox1: false, checkbox2: false }
      ];
      
      const allAspects = getAvailableAspects();
      const shuffled = [...allAspects].sort(() => Math.random() - 0.5);
      for (let i = 0; i < Math.min(4, shuffled.length); i++) {
        const aspect = shuffled[i];
        character.selectedAspects.push({
          id: `${aspect.source}-${aspect.name}`,
          ...aspect,
          trackSize: aspect.track,
          damageStates: Array(aspect.track).fill('default')
        });
      }
      
      const shuffledEdges = [...GAME_DATA.edges].sort(() => Math.random() - 0.5);
      character.selectedEdges = shuffledEdges.slice(0, 3).map(e => e.name);
      
      let pointsLeft = BUDGETS.skillPoints;
      while (pointsLeft > 0) {
        const skill = GAME_DATA.skills[Math.floor(Math.random() * GAME_DATA.skills.length)];
        const current = character.skills[skill] || 0;
        if (current < 2) {
          character.skills[skill] = current + 1;
          pointsLeft--;
        }
      }
      
      render();
    }
    
    function createCharacter() {
      if (character.selectedAspects.length !== BUDGETS.aspects) {
        alert(`Please select exactly ${BUDGETS.aspects} aspects`);
        return;
      }
      
      if (character.selectedEdges.length !== BUDGETS.edges) {
        alert(`Please select exactly ${BUDGETS.edges} edges`);
        return;
      }
      
      const skillPoints = Object.values(character.skills).reduce((sum, v) => sum + v, 0);
      const languagePoints = Object.entries(character.languages)
        .filter(([name]) => name !== 'Low Sour')
        .reduce((sum, [,v]) => sum + v, 0);
      
      if (skillPoints + languagePoints !== BUDGETS.skillPoints) {
        alert(`Please allocate all ${BUDGETS.skillPoints} skill/language points (currently allocated: ${skillPoints + languagePoints})`);
        return;
      }
      
      character.mode = 'play';
      render();
    }
    
    function setMode(mode) {
      character.mode = mode;
      render();
    }
    
    function render() {
      const app = document.getElementById('app');
      
      if (character.mode === 'creation') {
        renderCreationMode(app);
      } else if (character.mode === 'play') {
        renderPlayMode(app);
      } else if (character.mode === 'advancement') {
        renderAdvancementMode(app);
      }
    }
    
    function renderCreationMode(app) {
      const allAspects = getAvailableAspects();
      const bloodlineAspects = allAspects.filter(a => a.category === 'Bloodline');
      const originAspects = allAspects.filter(a => a.category === 'Origin');
      const postAspects = allAspects.filter(a => a.category === 'Post');
      
      const aspectsSelected = character.selectedAspects.length;
      const edgesSelected = character.selectedEdges.length;
      
      const skillPoints = Object.values(character.skills).reduce((sum, v) => sum + v, 0);
      const languagePoints = Object.entries(character.languages)
        .filter(([name]) => name !== 'Low Sour')
        .reduce((sum, [,v]) => sum + v, 0);
      const totalPoints = skillPoints + languagePoints;
      
      app.innerHTML = `
        <div style="padding: 20px; max-width: 1400px; margin: 0 auto; padding-bottom: 80px;">
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Character Name</label>
            <input type="text" value="${character.name}" 
                   onchange="character.name = this.value; render();"
                   placeholder="Enter name..." 
                   style="width: 300px; font-size: 16px;">
          </div>
          
          <div style="margin-bottom: 40px;">
            <h2 class="section-header">Core Elements</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Bloodline</label>
                <select onchange="character.bloodline = this.value; character.selectedAspects = []; render();" 
                        style="width: 100%; font-size: 16px;">
                  ${GAME_DATA.bloodlines.map(b => `<option value="${b}" ${character.bloodline === b ? 'selected' : ''}>${b}</option>`).join('')}
                </select>
              </div>
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Origin</label>
                <select onchange="character.origin = this.value; character.selectedAspects = []; render();" 
                        style="width: 100%; font-size: 16px;">
                  ${GAME_DATA.origins.map(o => `<option value="${o}" ${character.origin === o ? 'selected' : ''}>${o}</option>`).join('')}
                </select>
              </div>
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Post</label>
                <select onchange="character.post = this.value; character.selectedAspects = []; render();" 
                        style="width: 100%; font-size: 16px;">
                  ${GAME_DATA.posts.map(p => `<option value="${p}" ${character.post === p ? 'selected' : ''}>${p}</option>`).join('')}
                </select>
              </div>
            </div>
          </div>
          
          <div style="margin-bottom: 40px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
              <h2 class="section-header" style="margin: 0;">Aspects</h2>
              <div class="budget-indicator">${aspectsSelected}/${BUDGETS.aspects}</div>
            </div>
            <div class="grid-3col">
              <div class="flex-col-gap">
                <h3 class="subsection-header">${character.bloodline}</h3>
                ${bloodlineAspects.map(aspect => {
                  const id = `${aspect.source}-${aspect.name}`;
                  const escapedId = id.replace(/'/g, "\\'");
                  const isSelected = character.selectedAspects.some(a => a.id === id);
                  const isDisabled = !isSelected && aspectsSelected >= BUDGETS.aspects;
                  return `
                    <div class="aspect-card ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}" 
                         onclick="toggleAspect('${escapedId}')">
                      <div class="aspect-meta">${aspect.source} ${aspect.type}</div>
                      <div class="aspect-name" style="margin-bottom: 4px;">${aspect.name}</div>
                      <div class="aspect-description">${aspect.description}</div>
                      <div style="margin-top: 8px;">Track: ${aspect.track}</div>
                    </div>
                  `;
                }).join('')}
              </div>
              
              <div class="flex-col-gap">
                <h3 class="subsection-header">${character.origin}</h3>
                ${originAspects.map(aspect => {
                  const id = `${aspect.source}-${aspect.name}`;
                  const escapedId = id.replace(/'/g, "\\'");
                  const isSelected = character.selectedAspects.some(a => a.id === id);
                  const isDisabled = !isSelected && aspectsSelected >= BUDGETS.aspects;
                  return `
                    <div class="aspect-card ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}" 
                         onclick="toggleAspect('${escapedId}')">
                      <div class="aspect-meta">${aspect.source} ${aspect.type}</div>
                      <div class="aspect-name" style="margin-bottom: 4px;">${aspect.name}</div>
                      <div class="aspect-description">${aspect.description}</div>
                      <div style="margin-top: 8px;">Track: ${aspect.track}</div>
                    </div>
                  `;
                }).join('')}
              </div>
              
              <div class="flex-col-gap">
                <h3 class="subsection-header">${character.post}</h3>
                ${postAspects.map(aspect => {
                  const id = `${aspect.source}-${aspect.name}`;
                  const escapedId = id.replace(/'/g, "\\'");
                  const isSelected = character.selectedAspects.some(a => a.id === id);
                  const isDisabled = !isSelected && aspectsSelected >= BUDGETS.aspects;
                  return `
                    <div class="aspect-card ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}" 
                         onclick="toggleAspect('${escapedId}')">
                      <div class="aspect-meta">${aspect.source} ${aspect.type}</div>
                      <div class="aspect-name" style="margin-bottom: 4px;">${aspect.name}</div>
                      <div class="aspect-description">${aspect.description}</div>
                      <div style="margin-top: 8px;">Track: ${aspect.track}</div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          </div>
          
          <div style="margin-bottom: 40px; display: grid; grid-template-columns: 1fr 2fr; gap: 32px;">
            <div>
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h2 class="section-header" style="margin: 0;">Edges</h2>
                <div class="budget-indicator">${edgesSelected}/${BUDGETS.edges}</div>
              </div>
              <div style="display: flex; flex-direction: column; gap: 12px;">
                ${GAME_DATA.edges.map(edge => {
                  const isSelected = character.selectedEdges.includes(edge.name);
                  const isDisabled = !isSelected && edgesSelected >= BUDGETS.edges;
                  return `
                    <div class="edge-card ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}" 
                         onclick="toggleEdge('${edge.name}')">
                      <div class="aspect-name" style="margin-bottom: 4px;">${edge.name}</div>
                      <div class="edge-tagline" style="font-size: 12px; color: ${isSelected ? '#9CA3AF' : '#6B7280'};">${edge.tagline}</div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
            
            <div>
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h2 class="section-header" style="margin: 0;">Skills & Languages</h2>
                <div class="budget-indicator">${totalPoints}/${BUDGETS.skillPoints}</div>
              </div>
              
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px;">
                <div style="display: flex; flex-direction: column; gap: 4px;">
                  <h3 class="subsection-header" style="margin-bottom: 12px;">Skills</h3>
                  ${GAME_DATA.skills.map(skill => {
                    const rank = character.skills[skill] || 0;
                    const canIncrease = rank < 2 && totalPoints < BUDGETS.skillPoints;
                    return `
                      <div class="flex-between" style="margin-bottom: 8px;">
                        <div class="skill-name">${skill}</div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                          <button onclick="adjustSkill('${skill}', -1)" ${rank === 0 ? 'disabled' : ''}>âˆ’</button>
                          ${[0, 1, 2].map(i => `<div class="track-box ${i < rank ? 'active' : ''}"></div>`).join('')}
                          <button onclick="adjustSkill('${skill}', 1)" ${!canIncrease ? 'disabled' : ''}>+</button>
                        </div>
                      </div>
                    `;
                  }).join('')}
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 4px;">
                  <h3 class="subsection-header" style="margin-bottom: 12px;">Languages</h3>
                  ${GAME_DATA.languages.map(lang => {
                    const rank = character.languages[lang] || 0;
                    const isLowSour = lang === 'Low Sour';
                    const canIncrease = !isLowSour && rank < 2 && totalPoints < BUDGETS.skillPoints;
                    const canDecrease = !isLowSour && rank > 0;
                    return `
                      <div class="flex-between" style="margin-bottom: 8px;">
                        <div class="skill-name">${lang}</div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                          <button onclick="adjustLanguage('${lang}', -1)" ${!canDecrease ? 'disabled' : ''}>âˆ’</button>
                          ${[0, 1, 2].map(i => `<div class="track-box ${i < rank ? 'active' : ''}"></div>`).join('')}
                          <button onclick="adjustLanguage('${lang}', 1)" ${!canIncrease ? 'disabled' : ''}>+</button>
                        </div>
                      </div>
                    `;
                  }).join('')}
                </div>
              </div>
            </div>
          </div>
          
          ${renderMilestones()}
        </div>
        
        <div class="sticky-action-bar">
          <button onclick="generateRandomCharacter()">Generate Random Character</button>
          <button onclick="createCharacter()" class="primary" 
                  ${aspectsSelected === BUDGETS.aspects && edgesSelected === BUDGETS.edges && totalPoints === BUDGETS.skillPoints ? '' : 'disabled'}>
            Create Character
          </button>
        </div>
      `;
    }
    
    function renderPlayMode(app) {
      app.innerHTML = `
        <div style="padding: 20px; max-width: 1400px; margin: 0 auto; padding-bottom: 80px;">
          <div style="margin-bottom: 32px; padding-bottom: 24px; border-bottom: 2px solid #E5E7EB;">
            <div style="display: flex; gap: 48px; align-items: baseline;">
              <div>
                <div class="char-label">Character Name</div>
                <div class="char-name-header">${character.name}</div>
              </div>
              <div>
                <div class="char-label">Bloodline</div>
                <div class="char-name-header">${character.bloodline}</div>
              </div>
              <div>
                <div class="char-label">Origin</div>
                <div class="char-name-header">${character.origin}</div>
              </div>
              <div>
                <div class="char-label">Post</div>
                <div class="char-name-header">${character.post}</div>
              </div>
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 3fr; gap: 32px; margin-bottom: 32px;">
            <div>
              <h2 class="section-header">Edges</h2>
              ${character.selectedEdges.map(edgeName => `
                <div class="aspect-name" style="color: #111827; margin-bottom: 4px;">${edgeName}</div>
              `).join('')}
            </div>
            
            <div style="margin-bottom: 32px;">
              <h2 class="section-header">Skills</h2>
              ${GAME_DATA.skills.map(skill => {
                const rank = character.skills[skill] || 0;
                return `
                  <div class="skill-row">
                    <div class="skill-name">${skill}</div>
                    <div style="display: flex; gap: 4px;">
                      ${[0, 1, 2].map(i => `<div class="track-box small ${i < rank ? 'active' : ''}"></div>`).join('')}
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
            
            <div>
              <h2 class="section-header">Languages</h2>
              ${GAME_DATA.languages.map(lang => {
                const rank = character.languages[lang] || 0;
                return `
                  <div class="skill-row">
                    <div class="skill-name">${lang}</div>
                    <div style="display: flex; gap: 4px;">
                      ${[0, 1, 2].map(i => `<div class="track-box small ${i < rank ? 'active' : ''}"></div>`).join('')}
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
            
            <div>
              <h2 class="section-header">Aspects</h2>
              ${character.selectedAspects.map(aspect => `
                <div style="margin-bottom: 8px; padding: 8px; border-radius: 2px;">
                  <div style="display: flex; gap: 8px; align-items: flex-start;">
                    <div style="display: flex; gap: 8px; padding-top: 4px; flex-shrink: 0; width: 165px;">
                      ${Array(5).fill(0).map((_, i) => {
                        if (i < aspect.trackSize) {
                          const state = aspect.damageStates[i];
                          return `
                            <div class="track-box ${state}" 
                                 onclick="cycleAspectDamage('${aspect.id}', ${i})"
                                 style="cursor: pointer;">
                              ${state === 'marked' ? '/' : state === 'burned' ? 'X' : ''}
                            </div>
                          `;
                        } else {
                          return `<div style="width: 26px; height: 26px;"></div>`;
                        }
                      }).join('')}
                    </div>
                    <div style="flex: 1; min-width: 0;">
                      <div class="aspect-name" style="margin-bottom: 4px;">${aspect.name}</div>
                      <div class="aspect-meta">${aspect.source} ${aspect.type}</div>
                      <div class="aspect-description">${aspect.description}</div>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
          
          ${renderMilestones()}
        </div>
        
        <div class="sticky-action-bar">
          <button onclick="setMode('advancement')">Advancement</button>
        </div>
      `;
    }
    
    function renderAdvancementMode(app) {
      const allAspects = getAvailableAspects();
      const bloodlineAspects = allAspects.filter(a => a.category === 'Bloodline');
      const originAspects = allAspects.filter(a => a.category === 'Origin');
      const postAspects = allAspects.filter(a => a.category === 'Post');
      
      app.innerHTML = `
        <div style="padding: 20px; max-width: 1400px; margin: 0 auto; padding-bottom: 80px;">
          <div style="margin-bottom: 32px; padding-bottom: 24px; border-bottom: 2px solid #E5E7EB;">
            <div style="display: flex; gap: 48px; align-items: baseline;">
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Character Name</label>
                <input type="text" value="${character.name}" 
                       onchange="character.name = this.value; render();"
                       placeholder="Enter name..." 
                       style="width: 300px; font-size: 16px;">
              </div>
              <div>
                <div class="char-label">Bloodline</div>
                <div class="char-name-header">${character.bloodline}</div>
              </div>
              <div>
                <div class="char-label">Origin</div>
                <div class="char-name-header">${character.origin}</div>
              </div>
              <div>
                <div class="char-label">Post</div>
                <div class="char-name-header">${character.post}</div>
              </div>
            </div>
          </div>
          
          <div style="margin-bottom: 40px;">
            <h2 class="section-header">Aspects</h2>
            <div class="grid-3col">
              <div class="flex-col-gap">
                <h3 class="subsection-header">${character.bloodline}</h3>
                ${bloodlineAspects.map(aspect => {
                  const id = `${aspect.source}-${aspect.name}`;
                  const escapedId = id.replace(/'/g, "\\'");
                  const selectedAspect = character.selectedAspects.find(a => a.id === id);
                  const isSelected = !!selectedAspect;
                  
                  return `
                    <div class="aspect-card ${isSelected ? 'selected' : ''}" 
                         onclick="toggleAspect('${escapedId}')"
                         style="position: relative;">
                      ${isSelected ? `
                        <div style="display: flex; gap: 8px; align-items: center; padding-top: 4px; margin-bottom: 4px;">
                          <button onclick="event.stopPropagation(); expandAspectTrack('${escapedId}', -1)" 
                                  ${selectedAspect.trackSize <= aspect.track ? 'disabled' : ''}
                                  style="flex-shrink: 0; padding: 4px 8px; font-size: 14px;">âˆ’</button>
                          <div style="display: flex; gap: 8px; flex-shrink: 0;" onclick="event.stopPropagation()">
                            ${Array(selectedAspect.trackSize).fill(0).map((_, i) => {
                              const isNew = i >= aspect.track;
                              return `<div class="track-box ${isNew ? 'new' : ''}"></div>`;
                            }).join('')}
                          </div>
                          <button onclick="event.stopPropagation(); expandAspectTrack('${escapedId}', 1)" 
                                  ${selectedAspect.trackSize >= 5 ? 'disabled' : ''}
                                  style="flex-shrink: 0; padding: 4px 8px; font-size: 14px;">+</button>
                        </div>
                      ` : ''}
                      <div class="aspect-meta">${aspect.source} ${aspect.type}</div>
                      <div class="aspect-name" style="margin-bottom: 4px;">${aspect.name}</div>
                      <div class="aspect-description">${aspect.description}</div>
                      ${!isSelected ? `<div style="margin-top: 8px;">Track: ${aspect.track}</div>` : ''}
                    </div>
                  `;
                }).join('')}
              </div>
              
              <div class="flex-col-gap">
                <h3 class="subsection-header">${character.origin}</h3>
                ${originAspects.map(aspect => {
                  const id = `${aspect.source}-${aspect.name}`;
                  const escapedId = id.replace(/'/g, "\\'");
                  const selectedAspect = character.selectedAspects.find(a => a.id === id);
                  const isSelected = !!selectedAspect;
                  
                  return `
                    <div class="aspect-card ${isSelected ? 'selected' : ''}" 
                         onclick="toggleAspect('${escapedId}')"
                         style="position: relative;">
                      ${isSelected ? `
                        <div style="display: flex; gap: 8px; align-items: center; padding-top: 4px; margin-bottom: 4px;">
                          <button onclick="event.stopPropagation(); expandAspectTrack('${escapedId}', -1)" 
                                  ${selectedAspect.trackSize <= aspect.track ? 'disabled' : ''}
                                  style="flex-shrink: 0; padding: 4px 8px; font-size: 14px;">âˆ’</button>
                          <div style="display: flex; gap: 8px; flex-shrink: 0;" onclick="event.stopPropagation()">
                            ${Array(selectedAspect.trackSize).fill(0).map((_, i) => {
                              const isNew = i >= aspect.track;
                              return `<div class="track-box ${isNew ? 'new' : ''}"></div>`;
                            }).join('')}
                          </div>
                          <button onclick="event.stopPropagation(); expandAspectTrack('${escapedId}', 1)" 
                                  ${selectedAspect.trackSize >= 5 ? 'disabled' : ''}
                                  style="flex-shrink: 0; padding: 4px 8px; font-size: 14px;">+</button>
                        </div>
                      ` : ''}
                      <div class="aspect-meta">${aspect.source} ${aspect.type}</div>
                      <div class="aspect-name" style="margin-bottom: 4px;">${aspect.name}</div>
                      <div class="aspect-description">${aspect.description}</div>
                      ${!isSelected ? `<div style="margin-top: 8px;">Track: ${aspect.track}</div>` : ''}
                    </div>
                  `;
                }).join('')}
              </div>
              
              <div class="flex-col-gap">
                <h3 class="subsection-header">${character.post}</h3>
                ${postAspects.map(aspect => {
                  const id = `${aspect.source}-${aspect.name}`;
                  const escapedId = id.replace(/'/g, "\\'");
                  const selectedAspect = character.selectedAspects.find(a => a.id === id);
                  const isSelected = !!selectedAspect;
                  
                  return `
                    <div class="aspect-card ${isSelected ? 'selected' : ''}" 
                         onclick="toggleAspect('${escapedId}')"
                         style="position: relative;">
                      ${isSelected ? `
                        <div style="display: flex; gap: 8px; align-items: center; padding-top: 4px; margin-bottom: 4px;">
                          <button onclick="event.stopPropagation(); expandAspectTrack('${escapedId}', -1)" 
                                  ${selectedAspect.trackSize <= aspect.track ? 'disabled' : ''}
                                  style="flex-shrink: 0; padding: 4px 8px; font-size: 14px;">âˆ’</button>
                          <div style="display: flex; gap: 8px; flex-shrink: 0;" onclick="event.stopPropagation()">
                            ${Array(selectedAspect.trackSize).fill(0).map((_, i) => {
                              const isNew = i >= aspect.track;
                              return `<div class="track-box ${isNew ? 'new' : ''}"></div>`;
                            }).join('')}
                          </div>
                          <button onclick="event.stopPropagation(); expandAspectTrack('${escapedId}', 1)" 
                                  ${selectedAspect.trackSize >= 5 ? 'disabled' : ''}
                                  style="flex-shrink: 0; padding: 4px 8px; font-size: 14px;">+</button>
                        </div>
                      ` : ''}
                      <div class="aspect-meta">${aspect.source} ${aspect.type}</div>
                      <div class="aspect-name" style="margin-bottom: 4px;">${aspect.name}</div>
                      <div class="aspect-description">${aspect.description}</div>
                      ${!isSelected ? `<div style="margin-top: 8px;">Track: ${aspect.track}</div>` : ''}
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          </div>
				
				
            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 32px;">
          
          	  <div style="margin-bottom: 40px;">
                <h2 class="section-header">Edges</h2>
                ${character.selectedEdges.map(edgeName => `
                  <div class="aspect-name" style="color: #111827; margin-bottom: 4px;">${edgeName}</div>
                `).join('')}
              </div>
			
          	<div style="margin-bottom: 40px;">
			
            <h2 class="section-header">Skills & Languages</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px;">
				
				
              <div style="display: flex; flex-direction: column; gap: 4px;">
                <h3 class="subsection-header" style="margin-bottom: 12px;">Skills</h3>
                ${GAME_DATA.skills.map(skill => {
                  const rank = character.skills[skill] || 0;
                  return `
                    <div class="flex-between" style="margin-bottom: 8px;">
                      <div class="skill-name">${skill}</div>
                      <div style="display: flex; gap: 8px; align-items: center;">
                        <button onclick="adjustSkill('${skill}', -1)" ${rank === 0 ? 'disabled' : ''}>âˆ’</button>
                        ${[0, 1, 2].map(i => `<div class="track-box ${i < rank ? 'active' : ''}"></div>`).join('')}
                        <button onclick="adjustSkill('${skill}', 1)" ${rank >= 3 ? 'disabled' : ''}>+</button>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
              
              <div style="display: flex; flex-direction: column; gap: 4px;">
                <h3 class="subsection-header" style="margin-bottom: 12px;">Languages</h3>
                ${GAME_DATA.languages.map(lang => {
                  const rank = character.languages[lang] || 0;
                  return `
                    <div class="flex-between" style="margin-bottom: 8px;">
                      <div class="skill-name">${lang}</div>
                      <div style="display: flex; gap: 8px; align-items: center;">
                        <button onclick="adjustLanguage('${lang}', -1)" ${rank === 0 || lang === 'Low Sour' ? 'disabled' : ''}>âˆ’</button>
                        ${[0, 1, 2].map(i => `<div class="track-box ${i < rank ? 'active' : ''}"></div>`).join('')}
                        <button onclick="adjustLanguage('${lang}', 1)" ${rank >= 3 ? 'disabled' : ''}>+</button>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
				
            </div>
			</div>
          </div>
          
          ${renderMilestones()}
        </div>
        
        <div class="sticky-action-bar">
          <button onclick="setMode('play')" class="primary">Save Changes</button>
          <button onclick="setMode('play')">Cancel</button>
        </div>
      `;
    }
    
    // Initialize app
    loadAspectData();
  </script>
</body>
</html>